import axios from"axios";import{returnError}from"./errorActions";export const loadUser=()=>(dispatch,getState)=>{dispatch({type:"USER_LOADING"}),axios.get("/api/auth/user",tokenConfig(getState)).then(res=>{dispatch({type:"USER_LOADED",payload:res.data})}).catch(err=>{dispatch(returnError(err.response.data,err.response.status)),dispatch({type:"AUTH_ERROR"})})};export const register=(name,email,password)=>dispatch=>{const config={headers:{"Content-type":"application/json"}},body=JSON.stringify({name:name,email:email,password:password});axios.post("/api/users",body,config).then(res=>dispatch({type:"REGISTER_SUCCESS",payload:res.data})).then(res=>dispatch({type:"CLEAR_ERROR"})).catch(err=>{dispatch(returnError(err.response.data,err.response.status,"REGISTER_FAILED")),dispatch({type:"REGISTER_FAILED"})})};export const login=(name,password)=>dispatch=>{const config={headers:{"Content-type":"application/json"}},body=JSON.stringify({name:name,password:password});axios.post("/api/auth",body,config).then(res=>dispatch({type:"LOGIN_SUCCESS",payload:res.data})).then(res=>dispatch({type:"CLEAR_ERROR"})).catch(err=>{dispatch(returnError(err.response.data,err.response.status,"LOGIN_FAILED")),dispatch({type:"LOGIN_FAILED"})})};export const logout=()=>({type:"LOGOUT_SUCCESS"});export const tokenConfig=getState=>{const token=getState().auth.token,config={headers:{"Content-type":"application/json"}};return token&&(config.headers["x-auth-token"]=token),config};